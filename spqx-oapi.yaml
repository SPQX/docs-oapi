openapi: "3.0.2"
info:
  description: "This is the API documentation for the management and budget services of \
  SPQ Express.  More information can be found in the links below."
  version: "0.0.1"
  title: "SPQ Express"
  termsOfService: "https://www.spqexpress.com/tos"
  contact:
    email: "jcatronspqx@gmail.com"
  license:
    name: "Private License"
    url: "https://www.spqexpress/license"
externalDocs:
  description: "Find out more about SPQ Express"
  url: "https://www.spqexpress.com"
servers:
  - url: http://localhost:8080 # todo remove this server when publishing externally
    description: Development server
  - url: https://api.spqexpress.com
    description: Production server
  - url: https://api-uat.spqexpress.com
    description: Staging server
tags:
- name: Products
  description: "Management of products used for price calculation"
  externalDocs:
    description: "For more information"
    url: "https://www.spqexpress.com/services/management"
- name: Attributes
  description: "Management of attributes used for dynamic values within product price calculation"
  externalDocs:
    description: "For more information"
    url: "https://www.spqexpress.com/services/management"
paths:
  /products:
    get:
      summary: List product configurations
      description: >
        This resource provides a list of products in the system.
        Each product will be unique by numeric `id`.
      responses:
        '200':
          description: A JSON object representation of a Product
          content:
            application/json:
              schema:
                items:
                  $ref: '#/components/schemas/Product'
        '401':
          description: Authorization header is missing or invalid
      tags:
        - "Products"
    post:
      summary: Create a product configuration
      description: >
        This resource creates a new product configuration in the system.
        The product will be saved with the provided configuration and a
        unique `id` generated by the system.
      requestBody:
        $ref: '#/components/requestBodies/NewProductBody'
      responses:
        '200':
          $ref: '#/components/responses/ProductResponse'
      tags:
        - "Products"
    put:
      summary: Replace a product configuration
      description: >
        This resource overwrites a product configuration in the system.
        The product will be saved with the provided configuration overwriting
        the existing product found by the unique `id`.
      requestBody:
        $ref: '#/components/requestBodies/ProductBody'
      responses:
        '200':
          $ref: '#/components/responses/ProductResponse'
      tags:
        - "Products"
  /products/{product-id}:
    get:
      summary: Get a product configuration
      description: >
        This resource provides the product configuration for the
        product with the given unique `id` in the path.
      parameters:
        - $ref: '#/components/parameters/productId'
      responses:
        '200':
          $ref: '#/components/responses/ProductResponse'
      tags:
        - "Products"
    delete:
      summary: Remove a product configuration
      description: >
        Removes the product configuration for the given
        unique product `id` in the path.
      parameters:
        - $ref: '#/components/parameters/productId'
      responses:
        '204':
          description: Successfully removed the resource, no content will be returned
      tags:
        - "Products"
  /products/{product-id}/units:
    get:
      summary: Get a list of configured units
      description: >
        This resource provides a list of unit configurations for the
        product with the given unique `product-id` in the path.
      parameters:
        - $ref: '#/components/parameters/productId'
      responses:
        '200':
          description: A JSON object representation of a Unit
          content:
            application/json:
              schema:
                items:
                  $ref: '#/components/schemas/Unit'
      tags:
        - "Products"
    post:
      summary: Configure a new unit
      description: >
        This resource creates a new unit configuration for the product with
        `product-id`. The unit will be saved with the provided configuration
        and a unique `id` generated by the system.
      parameters:
        - $ref: '#/components/parameters/productId'
      requestBody:
        $ref: '#components/requestBodies/NewUnitBody'
      responses:
        '200':
          description: A JSON object representation of a Unit
          content:
            application/json:
              schema:
                items:
                  $ref: '#/components/schemas/Unit'
      tags:
        - "Products"
    put:
      summary: Replace a unit configuration
      description: >
        This resource overwrites a unit configuration in the system.
        The unit will be saved with the provided configuration overwriting
        the existing unit found by the unique `id` in the request body.
      parameters:
        - $ref: '#/components/parameters/productId'
      requestBody:
        $ref: '#components/requestBodies/UnitBody'
      responses:
        '200':
          $ref: '#/components/responses/UnitResponse'
      tags:
        - "Products"
  /products/{product-id}/units/{unit-id}:
    get:
      summary: Get a unit configuration
      description: >
        This resource provides the unit configuration for the
        unit with the given unique `unit-id` in the path.
        Supplied `product-id` must also be correct.
      parameters:
        - $ref: '#/components/parameters/productId'
        - $ref: '#/components/parameters/unitId'
      responses:
        '200':
          $ref: '#/components/responses/UnitResponse'
      tags:
        - "Products"
    delete:
      summary: Delete a unit configuration
      description: >
        Removes the unit configuration for the given unique `product-id` and
        `unit-id` in the path.
      parameters:
        - $ref: '#/components/parameters/productId'
        - $ref: '#/components/parameters/unitId'
      responses:
        '204':
          description: Successfully removed the resource, no content will be returned
      tags:
        - "Products"
  /products/{product-id}/{unit-id}/tasks:
    get:
      summary: Get a list of configured tasks
      description: >
        This resource provides a list of task configurations for the
        unit with the given unique `unit-id` in the path.
        The given `product-id` must match the correct unique id for the provided unit.
      parameters:
        - $ref: '#/components/parameters/productId'
        - $ref: '#/components/parameters/unitId'
      responses:
        '200':
          description: A JSON list of Tasks
          content:
            application/json:
              schema:
                items:
                  $ref: '#/components/schemas/Task'
      tags:
        - "Products"
    post:
      summary: Configure a new tasks
      description: >
        This resource creates a new task configurations for the
        unit with the given unique `unit-id` in the path.
        The given `product-id` must match the correct unique id for the provided unit.
      parameters:
        - $ref: '#/components/parameters/productId'
        - $ref: '#/components/parameters/unitId'
      requestBody:
        $ref: '#/components/requestBodies/NewTaskBody'
      responses:
        '200':
          description: A JSON list of Tasks
          content:
            application/json:
              schema:
                items:
                  $ref: '#/components/schemas/Task'
      tags:
        - "Products"
    put:
      summary: Replace a task configuration
      description: >
        This resource overwrites a task configurations for the
        unit with the given unique `unit-id` in the path.
        The given `product-id` must match the correct unique id for the provided unit.
      parameters:
        - $ref: '#/components/parameters/productId'
        - $ref: '#/components/parameters/unitId'
      requestBody:
        $ref: '#/components/requestBodies/TaskBody'
      responses:
        '200':
          $ref: '#/components/responses/TaskResponse'
      tags:
        - "Products"
  /products/{product-id}/{unit-id}/tasks/{task-id}:
    get:
      summary: Get a task configuration
      description: >
        This resource provides the task configuration for the
        task with the given unique `task-id` in the path.
        Supplied `product-id` and `unit-id` must also be correct.
      parameters:
        - $ref: '#/components/parameters/productId'
        - $ref: '#/components/parameters/unitId'
        - $ref: '#/components/parameters/taskId'
      responses:
        '200':
          $ref: '#/components/responses/TaskResponse'
      tags:
        - "Products"
    delete:
      summary: Delete a task configuration
      description: >
        This resource removes the task configuration for the
        task with the given unique `task-id` in the path.
        Supplied `product-id` and `unit-id` must also be correct.
      parameters:
        - $ref: '#/components/parameters/productId'
        - $ref: '#/components/parameters/unitId'
        - $ref: '#/components/parameters/taskId'
      responses:
        '204':
          description: Successfully removed the resource, no content will be returned
      tags:
        - "Products"
  /products/{product-id}/{unit-id}/{task-id}/subtasks:
    get:
      summary: Get a list of configured subtasks
      description: >
        This resource provides a list of subtask configurations for the
        unit with the given unique `task-id` in the path.
        The given `unit-id` and `product-id` must match the correct
        unique ids for the provided task.
      parameters:
        - $ref: '#/components/parameters/productId'
        - $ref: '#/components/parameters/unitId'
        - $ref: '#/components/parameters/taskId'
      responses:
        '200':
          description: A JSON list of SubTasks
          content:
            application/json:
              schema:
                items:
                  $ref: '#/components/schemas/SubTask'
      tags:
        - "Products"
    post:
      summary: Configure a new subtask
      description: >
        This resource creates a new subtask configuration for the
        task with the given unique `task-id` in the path.
        The given `unit-id` and `product-id` must match the correct
        unique id for the provided task.
      parameters:
        - $ref: '#/components/parameters/productId'
        - $ref: '#/components/parameters/unitId'
        - $ref: '#/components/parameters/taskId'
      requestBody:
        $ref: '#/components/requestBodies/NewTaskBody'
      responses:
        '200':
          description: A JSON list of SubTasks
          content:
            application/json:
              schema:
                items:
                  $ref: '#/components/schemas/SubTask'
      tags:
        - "Products"
    put:
      summary: Replace a subtask configuration
      description: >
        This resource overwrites a subtask configuration for the
        task with the given unique `task-id` in the path.
        The given `unit-id` and `product-id` must match the correct
        unique id for the provided unit.
      parameters:
        - $ref: '#/components/parameters/productId'
        - $ref: '#/components/parameters/unitId'
        - $ref: '#/components/parameters/taskId'
      requestBody:
        $ref: '#/components/requestBodies/SubTaskBody'
      responses:
        '200':
          $ref: '#/components/responses/SubTaskResponse'
      tags:
        - "Products"
  /products/{product-id}/{iunit-id}/{task-id}/subtasks/{subtask-id}:
    get:
      summary: Get a subtask configuration
      description: >
        This resource provides the subtask configuration for the
        subtask with the given unique `subtask-id` in the path.
        Supplied `product-id`, `unit-id`, and `task-id` must also be correct.
      parameters:
        - $ref: '#/components/parameters/productId'
        - $ref: '#/components/parameters/unitId'
        - $ref: '#/components/parameters/taskId'
        - $ref: '#/components/parameters/subtaskId'
      responses:
        '200':
          $ref: '#/components/responses/SubTaskResponse'
      tags:
        - "Products"
    delete:
      summary: Delete a subtask configuration
      description: >
        This resource removes the subtask configuration for the
        subtask with the given unique `subtask-id` in the path.
        Supplied `product-id`, `unit-id`, and `task-id` must also be correct.
      parameters:
        - $ref: '#/components/parameters/productId'
        - $ref: '#/components/parameters/unitId'
        - $ref: '#/components/parameters/taskId'
        - $ref: '#/components/parameters/subtaskId'
      responses:
        '204':
          description: Successfully removed the resource, no content will be returned
      tags:
        - "Products"
  /attributes:
    get:
      summary: List attribute configurations
      description: >
        This resource provides a list of attributes in the system.
        Each attribute will be unique by numeric `id`.
      responses:
        '200':
          description: A JSON object representation of an Attribute
          content:
            application/json:
              schema:
                items:
                  $ref: '#/components/schemas/Attribute'
        '401':
          description: Authorization header is missing or invalid
      tags:
        - "Attributes"
    post:
      summary: Create an attribute configuration
      description: >
        This resource creates a new attribute configuration in the system.
        The attribute will be saved with the provided configuration and a
        unique `id` generated by the system.
      requestBody:
        $ref: '#/components/requestBodies/NewAttributeBody'
      responses:
        '200':
          $ref: '#/components/responses/AttributeResponse'
      tags:
        - "Attributes"
    put:
      summary: Replace a attribute configuration
      description: >
        This resource overwrites an attribute configuration in the system.
        The attribute will be saved with the provided configuration overwriting
        the existing attribute found by the unique `id`.
      requestBody:
        $ref: '#/components/requestBodies/AttributeBody'
      responses:
        '200':
          $ref: '#/components/responses/AttributeResponse'
      tags:
        - "Attributes"
  /attributes/{attribute-id}:
    get:
      summary: Get an attribute configuration
      description: >
        This resource provides the attribute configuration for the
        attribute with the given unique `id` in the path.
      parameters:
        - $ref: '#/components/parameters/attributeId'
      responses:
        '200':
          $ref: '#/components/responses/AttributeResponse'
      tags:
        - "Attributes"
    delete:
      summary: Remove a attribute configuration
      description: >
        Removes the attribute configuration for the given
        unique attribute `id` in the path.
      parameters:
        - $ref: '#/components/parameters/attributeId'
      responses:
        '204':
          description: Successfully removed the resource, no content will be returned
      tags:
        - "Attributes"
components:
  schemas: # todo required fields
    NewProduct:
      type: object
      properties:
        displayName:
          type: string
    Product:
      allOf:
        - properties:
            id:
              type: integer
        - $ref: '#/components/schemas/NewProduct'
    NewUnit:
      type: object
      properties:
        displayName:
          type: string
        location:
          type: string
        UOM:
          type: string
        countryAttribute:
          type: string #todo this should be an attribute
        country:
          type: string
        startDateAttribute:
          type: string
        startDate:
          type: string
        endDateAttribute:
          type: string
        endDate:
          type: string
        quantityFormula:
          type: string
    Unit:
      allOf:
        - properties:
            id:
              type: integer
            productId:
              type: integer
        - $ref: '#/components/schemas/NewUnit'
    NewTask:
      allOf:
        - $ref: '#/components/schemas/NewUnit'
        - properties:
            resourceAttr:
              type: string
            resource:
              type: string
            hoursFormula:
              type: string
            hours:
              type: integer
            standardHoursFormula:
              type: string
            standardHours:
              type: integer
            efficientHoursFormula:
              type: string
            efficientHours:
              type: integer
    Task:
      allOf:
        - properties:
            id:
              type: integer
            unitId:
              type: integer
        - $ref: '#/components/schemas/NewTask'
    SubTask:
      allOf:
        - properties:
            id:
              type: integer
            taskId:
              type: integer
        - $ref: '#/components/schemas/NewTask'
    NewAttribute:
      type: object
      properties:
        displayName:
          type: string
        category:
          type: string
    Attribute:
      allOf:
        - properties:
            id:
              type: integer
        - $ref: '#/components/schemas/NewAttribute'
  requestBodies:
    ProductBody:
      description: A JSON object representation of a Product
      required: true
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Product'
    NewProductBody:
      description: A JSON object representation of a Product
      required: true
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/NewProduct'
    UnitBody:
      description: A JSON object representation of a Unit
      required: true
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Unit'
    NewUnitBody:
      description: A JSON object representation of a Unit
      required: true
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/NewUnit'
    TaskBody:
      description: A JSON object representation of a Task
      required: true
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Task'
    NewTaskBody:
      description: A JSON object representation of a Task/SubTask
      required: true
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/NewTask'
    SubTaskBody:
      description: A JSON object representation of a SubTask
      required: true
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/SubTask'
    AttributeBody:
      description: A JSON object representation of an Attribute
      required: true
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Attribute'
    NewAttributeBody:
      description: A JSON object representation of an Attribute
      required: true
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/NewAttribute'
  responses:
    ProductResponse:
      description: A JSON object representation of a Product
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Product'
    UnitResponse:
      description: A JSON object representation of a Unit
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Unit'
    TaskResponse:
      description: A JSON object representation of a Task
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Task'
    SubTaskResponse:
      description: A JSON object representation of a SubTask
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/SubTask'
    AttributeResponse:
      description: A JSON object representation of an Attribute
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Attribute'
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
  parameters:
    productId:
      in: path
      name: product-id
      required: true
      schema:
        type: integer
      description: Numberic id of the product
    unitId:
      in: path
      name: unit-id
      required: true
      schema:
        type: integer
      description: Numberic id of the unit
    taskId:
      in: path
      name: task-id
      required: true
      schema:
        type: integer
      description: Numberic id of the task
    subtaskId:
      in: path
      name: subtask-id
      required: true
      schema:
        type: integer
      description: Numberic id of the subtask
    attributeId:
      in: path
      name: attribute-id
      required: true
      schema:
        type: integer
      description: Numberic id of the attribute
security:
  - bearerAuth: []